"use strict";class t{oversized=!1;constructor(t=0,i=0,h=0,s=0,e=!1,r){this._width=t,this._height=i,this._x=h,this._y=s,this._data={},this._rot=e,this._allowRotation=r}static Collide(t,i){return t.collide(i)}static Contain(t,i){return t.contain(i)}area(){return this.width*this.height}collide(t){return t.x<this.x+this.width&&t.x+t.width>this.x&&t.y<this.y+this.height&&t.y+t.height>this.y}contain(t){return t.x>=this.x&&t.y>=this.y&&t.x+t.width<=this.x+this.width&&t.y+t.height<=this.y+this.height}_width;get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._dirty++)}_height;get height(){return this._height}set height(t){t!==this._height&&(this._height=t,this._dirty++)}_x;get x(){return this._x}set x(t){t!==this._x&&(this._x=t,this._dirty++)}_y;get y(){return this._y}set y(t){t!==this._y&&(this._y=t,this._dirty++)}_rot=!1;get rot(){return this._rot}set rot(t){if(!1!==this._allowRotation&&this._rot!==t){const i=this.width;this.width=this.height,this.height=i,this._rot=t,this._dirty++}}_allowRotation=void 0;get allowRotation(){return this._allowRotation}set allowRotation(t){this._allowRotation!==t&&(this._allowRotation=t,this._dirty++)}_data;get data(){return this._data}set data(t){null!==t&&t!==this._data&&(this._data=t,"object"==typeof t&&t.hasOwnProperty("allowRotation")&&(this._allowRotation=t.allowRotation),this._dirty++)}_dirty=0;get dirty(){return this._dirty>0}setDirty(t=!0){this._dirty=t?this._dirty+1:0}}class i{width;height;maxWidth;maxHeight;freeRects;rects;options;data;tag;_dirty=0;get dirty(){return this._dirty>0||this.rects.some((t=>t.dirty))}setDirty(t=!0){if(this._dirty=t?this._dirty+1:0,!t)for(let t of this.rects)t.setDirty&&t.setDirty(!1)}}class h extends i{maxWidth;maxHeight;padding;width;height;freeRects=[];rects=[];verticalExpand=!1;stage;border;options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:exports.PACKING_LOGIC.MAX_EDGE};constructor(i=e,h=e,s=0,r={}){super(),this.maxWidth=i,this.maxHeight=h,this.padding=s,this.options={...this.options,...r},this.width=this.options.smart?0:i,this.height=this.options.smart?0:h,this.border=this.options.border?this.options.border:0,this.freeRects.push(new t(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)),this.stage=new t(this.width,this.height)}add(...i){let h,s;if(1===i.length){if("object"!=typeof i[0])throw new Error("MacrectsBin.add(): Wrong parameters");s=i[0];let t=s.data&&s.data.tag?s.data.tag:s.tag?s.tag:void 0;if(this.options.tag&&this.options.exclusiveTag&&this.tag!==t)return}else{if(h=i.length>2?i[2]:null,this.options.tag&&this.options.exclusiveTag){if(h&&this.tag!==h.tag)return;if(!h&&this.tag)return}s=new t(i[0],i[1]),s.data=h,s.setDirty(!1)}const e=this.place(s);return e&&this.rects.push(e),e}repack(){let t=[];this.reset(),this.rects.sort(((t,i)=>{const h=Math.max(i.width,i.height)-Math.max(t.width,t.height);return 0===h&&t.hash&&i.hash?t.hash>i.hash?-1:1:h}));for(let i of this.rects)this.place(i)||t.push(i);for(let i of t)this.rects.splice(this.rects.indexOf(i),1);return t.length>0?t:void 0}reset(i=!1,h=!1){i&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],h&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new t(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new t(this.width,this.height),this._dirty=0}clone(){let t=new h(this.maxWidth,this.maxHeight,this.padding,this.options);for(let i of this.rects)t.add(i);return t}place(i){let h,s,e=i.data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;if(!this.options.tag||!this.options.exclusiveTag||this.tag===e){if(s=i.hasOwnProperty("_allowRotation")&&void 0!==i.allowRotation?i.allowRotation:this.options.allowRotation,h=this.findNode(i.width+this.padding,i.height+this.padding,s),h){this.updateBinSize(h);let t=this.freeRects.length,s=0;for(;s<t;)this.splitNode(this.freeRects[s],h)&&(this.freeRects.splice(s,1),t--,s--),s++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,i.x=h.x,i.y=h.y,void 0===i.rot&&(i.rot=!1),i.rot=h.rot?!i.rot:i.rot,this._dirty++,i}if(this.verticalExpand){if(this.updateBinSize(new t(i.width+this.padding,i.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new t(i.width+this.padding,i.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(i)}else if(this.updateBinSize(new t(i.width+this.padding,i.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new t(i.width+this.padding,i.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(i)}}findNode(i,h,s){let e,r,a,d=Number.MAX_VALUE;for(let o in this.freeRects)r=this.freeRects[o],r.width>=i&&r.height>=h&&(e=this.options.logic===exports.PACKING_LOGIC.MAX_AREA?r.width*r.height-i*h:Math.min(r.width-i,r.height-h),e<d&&(a=new t(i,h,r.x,r.y),d=e)),s&&r.width>=h&&r.height>=i&&(e=this.options.logic===exports.PACKING_LOGIC.MAX_AREA?r.width*r.height-h*i:Math.min(r.height-i,r.width-h),e<d&&(a=new t(h,i,r.x,r.y,!0),d=e));return a}splitNode(i,h){if(!i.collide(h))return!1;if(h.x<i.x+i.width&&h.x+h.width>i.x){if(h.y>i.y&&h.y<i.y+i.height){let s=new t(i.width,h.y-i.y,i.x,i.y);this.freeRects.push(s)}if(h.y+h.height<i.y+i.height){let s=new t(i.width,i.y+i.height-(h.y+h.height),i.x,h.y+h.height);this.freeRects.push(s)}}if(h.y<i.y+i.height&&h.y+h.height>i.y){if(h.x>i.x&&h.x<i.x+i.width){let s=new t(h.x-i.x,i.height,i.x,i.y);this.freeRects.push(s)}if(h.x+h.width<i.x+i.width){let s=new t(i.x+i.width-(h.x+h.width),i.height,h.x+h.width,i.y);this.freeRects.push(s)}}return!0}pruneFreeList(){let t=0,i=0,h=this.freeRects.length;for(;t<h;){i=t+1;let s=this.freeRects[t];for(;i<h;){let e=this.freeRects[i];if(e.contain(s)){this.freeRects.splice(t,1),t--,h--;break}s.contain(e)&&(this.freeRects.splice(i,1),i--,h--),i++}t++}}updateBinSize(t){if(!this.options.smart)return!1;if(this.stage.contain(t))return!1;let i=Math.max(this.width,t.x+t.width-this.padding+this.border),h=Math.max(this.height,t.y+t.height-this.padding+this.border);if(this.options.allowRotation){const s=Math.max(this.width,t.x+t.height-this.padding+this.border),e=Math.max(this.height,t.y+t.width-this.padding+this.border);s*e<i*h&&(i=s,h=e)}return this.options.pot&&(i=Math.pow(2,Math.ceil(Math.log(i)*Math.LOG2E)),h=Math.pow(2,Math.ceil(Math.log(h)*Math.LOG2E))),this.options.square&&(i=h=Math.max(i,h)),!(i>this.maxWidth+this.padding||h>this.maxHeight+this.padding)&&(this.expandFreeRects(i+this.padding,h+this.padding),this.width=this.stage.width=i,this.height=this.stage.height=h,!0)}expandFreeRects(i,h){this.freeRects.forEach(((t,s)=>{t.x+t.width>=Math.min(this.width+this.padding-this.border,i)&&(t.width=i-t.x-this.border),t.y+t.height>=Math.min(this.height+this.padding-this.border,h)&&(t.height=h-t.y-this.border)}),this),this.freeRects.push(new t(i-this.width-this.padding,h-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new t(i-2*this.border,h-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter((t=>!(t.width<=0||t.height<=0||t.x<this.border||t.y<this.border))),this.pruneFreeList()}}class s extends i{width;height;data;maxWidth;maxHeight;options;rects=[];freeRects;constructor(...i){if(super(),1===i.length){if("object"!=typeof i[0])throw new Error("OversizedElementBin: Wrong parameters");const t=i[0];this.rects=[t],this.width=t.width,this.height=t.height,this.data=t.data,t.oversized=!0}else{this.width=i[0],this.height=i[1],this.data=i.length>2?i[2]:null;const h=new t(this.width,this.height);h.oversized=!0,h.data=this.data,this.rects.push(h)}this.freeRects=[],this.maxWidth=this.width,this.maxHeight=this.height,this.options={smart:!1,pot:!1,square:!1}}add(){}reset(t=!1){}repack(){}clone(){return new s(this.rects[0])}}const e=4096;var r;exports.PACKING_LOGIC=void 0,(r=exports.PACKING_LOGIC||(exports.PACKING_LOGIC={}))[r.MAX_AREA=0]="MAX_AREA",r[r.MAX_EDGE=1]="MAX_EDGE";exports.Bin=i,exports.MaxRectsBin=h,exports.MaxRectsPacker=class{width;height;padding;bins;options={smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:exports.PACKING_LOGIC.MAX_EDGE};constructor(t=e,i=e,h=0,s={}){this.width=t,this.height=i,this.padding=h,this.bins=[],this.options={...this.options,...s}}add(...i){if(1===i.length){if("object"!=typeof i[0])throw new Error("MacrectsPacker.add(): Wrong parameters");const t=i[0];if(t.width>this.width||t.height>this.height)this.bins.push(new s(t));else{if(!this.bins.slice(this._currentBinIndex).find((i=>void 0!==i.add(t)))){let i=new h(this.width,this.height,this.padding,this.options),s=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&s&&(i.tag=s),i.add(t),this.bins.push(i)}}return t}{const e=new t(i[0],i[1]);if(i.length>2&&(e.data=i[2]),e.width>this.width||e.height>this.height)this.bins.push(new s(e));else{if(!this.bins.slice(this._currentBinIndex).find((t=>void 0!==t.add(e)))){let t=new h(this.width,this.height,this.padding,this.options);this.options.tag&&e.data.tag&&(t.tag=e.data.tag),t.add(e),this.bins.push(t)}}return e}}addArray(t){if(!this.options.tag||this.options.exclusiveTag)this.sort(t,this.options.logic).forEach((t=>this.add(t)));else{if(0===t.length)return;let i;t.sort(((t,i)=>{const h=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0,s=i.data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;return void 0===s?-1:void 0===h?1:s>h?-1:1}));let s=0;if(!this.bins.slice(this._currentBinIndex).find(((h,e)=>{let r=h.clone();for(let e=s;e<t.length;e++){const a=t[e],d=a.data&&a.data.tag?a.data.tag:a.tag?a.tag:void 0;if(0===e&&(i=d),d!==i)return i=d,this.sort(t.slice(s,e),this.options.logic).forEach((t=>h.add(t))),s=e,this.addArray(t.slice(e)),!0;if(void 0===d)return this.sort(t.slice(e),this.options.logic).forEach((t=>this.add(t))),s=t.length,!0;if(void 0===r.add(a))return this.sort(t.slice(s,e),this.options.logic).forEach((t=>h.add(t))),s=e,!1}return this.sort(t.slice(s),this.options.logic).forEach((t=>h.add(t))),!0}))){const i=t[s],e=new h(this.width,this.height,this.padding,this.options),r=i.data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;this.options.tag&&this.options.exclusiveTag&&r&&(e.tag=r),this.bins.push(e),e.add(i),s++,this.addArray(t.slice(s))}}}reset(){this.bins=[],this._currentBinIndex=0}repack(t=!0){if(t){let t=[];for(let i of this.bins)if(i.dirty){let h=i.repack();h&&t.push(...h)}return void this.addArray(t)}if(!this.dirty)return;const i=this.rects;this.reset(),this.addArray(i)}next(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}load(i){i.forEach(((i,e)=>{if(i.maxWidth>this.width||i.maxHeight>this.height)this.bins.push(new s(i.width,i.height,{}));else{let s=new h(this.width,this.height,this.padding,i.options);s.freeRects.splice(0),i.freeRects.forEach(((i,h)=>{s.freeRects.push(new t(i.width,i.height,i.x,i.y))})),s.width=i.width,s.height=i.height,i.tag&&(s.tag=i.tag),this.bins[e]=s}}),this)}save(){let t=[];return this.bins.forEach((i=>{let h={width:i.width,height:i.height,maxWidth:i.maxWidth,maxHeight:i.maxHeight,freeRects:[],rects:[],options:i.options};i.tag&&(h={...h,tag:i.tag}),i.freeRects.forEach((t=>{h.freeRects.push({x:t.x,y:t.y,width:t.width,height:t.height})})),t.push(h)})),t}sort(t,i=exports.PACKING_LOGIC.MAX_EDGE){return t.slice().sort(((t,h)=>{const s=i===exports.PACKING_LOGIC.MAX_EDGE?Math.max(h.width,h.height)-Math.max(t.width,t.height):h.width*h.height-t.width*t.height;return 0===s&&t.hash&&h.hash?t.hash>h.hash?-1:1:s}))}_currentBinIndex=0;get currentBinIndex(){return this._currentBinIndex}get dirty(){return this.bins.some((t=>t.dirty))}get rects(){let t=[];for(let i of this.bins)t.push(...i.rects);return t}},exports.OversizedElementBin=s,exports.Rectangle=t;
